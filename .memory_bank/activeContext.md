# Активный Контекст

Дата последнего обновления: 2025-01-22 16:00

## Текущий Фокус

**ПРОБЛЕМА**: ✅ **РЕШЕНА** - Ассеты не загружались в UI после деплоя на GitHub Pages

**Статус**: Проблема диагностирована и исправлена (commit: 976f018)

**Найденная проблема**:
- Tile registry загружался как пустой массив (0 тайлов вместо 263)
- Причина: динамический импорт JSON файла не работал корректно в production сборке Next.js
- Логи показали: `Loaded tile registry: 0 tiles`

**Решение**:
- Создан `lib/llm/tile-registry.ts` со статическим экспортом данных
- Заменены динамические импорты на статические в MapEditor и NewMapDialog
- Добавлено детальное логирование для отладки

**Ожидаемый результат**:
- Tile registry должен загружаться с 263 тайлами
- Ассеты должны отображаться в левой панели UI и диалоге создания карты

## Активные Задачи

- [x] Найти источник проблемы с загрузкой tile registry
- [x] Исправить импорт JSON данных для production сборки
- [ ] Проверить что ассеты теперь отображаются в UI после деплоя

## Контекст Сессии

**Диагностика проблемы**:
1. Логи показали что `getAssetPath()` работает корректно
2. Проблема была в загрузке tile registry - возвращался пустой массив
3. Динамический импорт `await import('@/lib/llm/tile-registry.json')` не работал в production
4. Решение: статический импорт через TypeScript файл

**Последние изменения**:
- Создан `lib/llm/tile-registry.ts` с экспортом данных из JSON
- Обновлен MapEditor для использования статического импорта
- Обновлен NewMapDialog для использования статического импорта
- Добавлено подробное логирование для отладки

**Следующие шаги**:
1. Дождаться деплоя (commit: 976f018)
2. Проверить логи в браузере - должно показать 263 тайла
3. Убедиться что UI показывает ассеты в левой панели

## Принятые решения

**Архитектурные решения для GitHub Pages**:
- Использовать статический экспорт Next.js вместо API routes
- Использовать tile registry вместо динамического сканирования ассетов
- Скрыть AI функции для статического деплоя
- Настроить basePath `/Medieval-Hexagon-Map-Editor` для repository deployment
- Копировать ассеты из `assets/` в `public/assets/` для статической раздачи

**Технические решения**:
- Функция `getAssetPath()` конвертирует пути с basePath в production
- Компоненты используют tile registry напрямую вместо API вызовов
- ModelPreview и TilePreview используют правильные пути к ассетам
- **Статический импорт JSON данных** через TypeScript файл для совместимости с production сборкой
