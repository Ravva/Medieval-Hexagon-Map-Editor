# Активный Контекст

Дата последнего обновления: 2025-01-22 15:30

## Текущий Фокус

**ПРОБЛЕМА**: Ассеты не загружаются в UI после деплоя на GitHub Pages

**Статус**: Отладка проблемы с загрузкой ассетов в UI

**Детали проблемы**:
- Деплой успешен (commit: cf338c9)
- Ассеты доступны по прямым ссылкам (например: https://ravva.github.io/Medieval-Hexagon-Map-Editor/assets/terrain/buildings/blue/building_home_B_blue.obj)
- Tile registry загружается корректно (263 тайла)
- Но ассеты не отображаются в левой панели UI и в диалоге создания карты
- Консоль показывает ошибку: `GET https://ravva.github.io/api/assets 404 (Not Found)`

**Выполненные действия**:
1. ✅ Добавлено детальное логирование в fetchAssets функцию
2. ✅ Добавлено логирование в getAssetPath функцию
3. ✅ Добавлено логирование состояния ассетов (assetCategories, selectedCategory, etc.)
4. ✅ Проверена структура tile registry - содержит корректные данные
5. ✅ Проверены компоненты MapEditor, NewMapDialog, TilePreview - используют tile registry правильно

**Текущая гипотеза**:
Где-то в коде все еще есть вызов к `/api/assets`, который не был найден в исходном коде. Возможно:
- Кэшированный код в браузере
- Старый bundled JavaScript файл
- Скрытый вызов в одном из компонентов

## Активные Задачи

- [ ] Найти источник вызова `/api/assets`
- [ ] Проверить логи в браузере после нового деплоя
- [ ] Убедиться что UI обновляется после загрузки ассетов

## Контекст Сессии

**Последние изменения**:
- Добавлено подробное логирование для отладки проблемы с ассетами
- Логирование показывает: NODE_ENV, basePath, результат конвертации путей
- Логирование состояния: длина массивов, выбранные категории/папки

**Открытые вопросы**:
- Откуда идет вызов к `/api/assets`?
- Почему UI не показывает ассеты несмотря на корректную загрузку tile registry?

**Следующие шаги**:
1. Проверить новые логи в браузере после деплоя
2. Если логи покажут проблему - исправить
3. Если логи не покажут проблему - искать скрытые вызовы API

## Принятые решения

**Архитектурные решения для GitHub Pages**:
- Использовать статический экспорт Next.js вместо API routes
- Использовать tile registry вместо динамического сканирования ассетов
- Скрыть AI функции для статического деплоя
- Настроить basePath `/Medieval-Hexagon-Map-Editor` для repository deployment
- Копировать ассеты из `assets/` в `public/assets/` для статической раздачи

**Технические решения**:
- Функция `getAssetPath()` конвертирует пути с basePath в production
- Компоненты используют tile registry напрямую вместо API вызовов
- ModelPreview и TilePreview используют правильные пути к ассетам
