# Активный Контекст

**Дата последнего обновления**: 2025-12-28

## Текущий Фокус

**Medieval Hexagon Map Editor** — это отдельный независимый проект для создания и редактирования гексагональных карт. Проект полностью независим и не связан с другими игровыми проектами.

**Текущая задача**: ✅ **ПОДДЕРЖКА ЛОКАЛЬНЫХ LLM МОДЕЛЕЙ** - Интеграция локальных моделей для генерации карт

**Статус**:
- ✅ Фаза 1: Подготовка инфраструктуры (тестирование API, tile registry) - ЗАВЕРШЕНО
- ✅ Фаза 2: Базовая генерация карт (MapGenerator, API endpoint) - ЗАВЕРШЕНО
- ✅ Фаза 3: Интеграция в UI редактора (кнопка Generate, диалог параметров) - ЗАВЕРШЕНО
- ✅ Фаза 4: Генерация реестра с анализом соединений - ЗАВЕРШЕНО
- ✅ Фаза 5: Поддержка локальных LLM моделей - ЗАВЕРШЕНО

**Система уровней**: Редактор поддерживает до 5 уровней высоты (0-4). Каждый уровень имеет фиксированную высоту (LEVEL_HEIGHT), равную высоте базового тайла. Тайлы верхних уровней размещаются на верхней поверхности нижележащих уровней.

## Активные Задачи

- [x] Настроить Next.js 16 + React 19 проект
- [x] Установить и настроить Shadcn/ui компоненты
- [x] Создать TypeScript версии Map и Hex классов
- [x] Создать React компонент MapEditor с Three.js интеграцией
- [x] Адаптировать ModelLoader для Next.js
- [x] Создать UI компоненты редактора (панели, кнопки)
- [x] Настроить пути к assets (симлинк)
- [x] Настроить Biome для линтинга
- [x] Настроить Bun как пакетный менеджер
- [x] Изучить и применить правила livedocs
- [x] Исправить позиционирование тайлов по уровням высоты
- [x] Упростить логику выделения тайлов (всегда выбирается верхний тайл)
- [x] Реализовать систему сохранения/загрузки карт
- [x] Исправить загрузку текстур в превью тайлов
- [x] Провести анализ системы координат для LLM-генерации карт
- [x] Реализовать полный переход на осевые координаты (q, r)
- [x] Реализовать копирование и вставку тайлов (Ctrl+C, Ctrl+V)
- [x] Реализовать множественное выделение (Ctrl+ЛКМ)
- [x] Реализовать undo/redo для операций копирования/вставки (Ctrl+Z, Ctrl+Y, Ctrl+Shift+Z)
- [x] Исправить визуализацию множественного выделения (рамка у всех выделенных тайлов)
- [x] Исправить логику undo/redo (сохранение истории до и после операций)
- [x] Интеграция LLM для автоматизированной генерации карт (ЗАВЕРШЕНО)
  - [x] Фаза 1: Подготовка инфраструктуры (тестирование API, tile registry)
  - [x] Фаза 2: Базовая генерация карт (MapGenerator, API endpoint)
  - [x] Фаза 3: Интеграция в UI редактора (кнопка Generate, диалог параметров)
  - [x] Улучшение промптов и пост-обработка (базовые тайлы, правила высот)
  - [x] Улучшение генерации карт - добавление информации о соединениях тайлов
  - [x] Создать TileConnectionAnalyzer для анализа геометрии OBJ и определения соединений
  - [x] Рефакторинг: переименование `exits` → `connections` (более точное название)
  - [x] Исправление анализа соединений для базовых тайлов (включение base в категорию для анализа)
  - [x] Новая логика анализа: проверка рёбер верхней поверхности тайла
  - [x] Добавить в tile registry информацию о соединениях для рек, дорог, coast, base
  - [x] Обновить AssetAnalyzer для автоматического извлечения информации о соединениях
  - [x] Реализовать валидацию связности рек/дорог после генерации
  - [x] Добавить правила проверки стыковки соседних тайлов в промпт LLM
  - [x] Создать интерфейс генерации реестра с визуализацией соединений (`/generate-registry`)
    - [x] API endpoint `/api/llm/generate-registry` для генерации реестра
    - [x] API endpoint `/api/llm/save-registry` для сохранения реестра
    - [x] Страница `/generate-registry` с 3D визуализацией тайлов
    - [x] Подсветка соединений (сферы на границах гексагона с цветовой индикацией типа)
    - [x] Интерфейс утверждения соединений
  - [ ] Визуальная валидация и корректировка соединений через UI `/generate-registry`
    - [x] Определение ТИПА соединения (grass, water, coast, road) вместо boolean
    - [x] Цветовая индикация типа соединения в интерфейсе:
      - Grass: чистый зеленый (0x00ff00)
      - Water: чистый синий (0x0066ff)
      - Coast: оранжево-золотой (0xffaa00)
      - Road: коричневый (0x8b4513)
      - Unknown: красный (0xff0000)
    - [x] Логика анализа рёбер верхней поверхности (top surface edge detection)
    - [x] Учет biome при определении типа соединения для base tiles (water→water, другие→grass)
    - [ ] Проверка и корректировка соединений для всех типов тайлов через UI
    - [ ] Исправление очистки сцены при переключении тайлов (текущий обходной путь: traverse + setTimeout)
  - [x] Быстрое копирование тайла при перетаскивании с зажатым CTRL
    - [x] Добавлен ref `isCopyModeRef` для отслеживания состояния CTRL при перетаскивании
    - [x] Создана функция `copyHexAtPosition` для копирования тайла без удаления оригинала
    - [x] Обновлена логика `handleCanvasClick` для выбора между копированием и перемещением
    - [x] Сохранение состояния CTRL в `onMouseDown` для определения режима копирования
    - [x] Поддержка undo/redo для операций копирования
    - [x] Автоматический поиск свободного уровня при копировании, если целевой уровень занят
  - [x] Операции с тайлами без предварительного выделения
    - [x] Копирование (Ctrl+C) работает с тайлом под курсором, если нет выделенных тайлов
    - [x] Перетаскивание работает с тайлом под курсором, если нет выделенных тайлов
    - [x] Быстрое копирование перетаскиванием (CTRL+перетаскивание) работает с тайлом под курсором
    - [x] Все операции используют `lastMouseHexRef` для определения тайла под курсором
  - [x] Поддержка локальных LLM моделей для генерации карт (2025-12-28)
    - [x] Доработка страницы тестирования LLM (`/test-llm`) для работы с локальными моделями
      - [x] Переключатель между Gemini API и локальным сервером
      - [x] Загрузка списка моделей через GET /v1/models
      - [x] Выбор модели из списка
      - [x] Тесты аналогичные Gemini: простое подключение, JSON Schema, пример карты, генерация 5x5
      - [x] Поддержка OpenAI-совместимого формата (POST /v1/chat/completions)
      - [x] Исправление формата JSON Schema (убрано использование json_object, используется только system message)
    - [x] Доработка страницы генерации карт для поддержки локальных моделей
      - [x] Переключатель между Gemini API и локальным сервером в диалоге генерации
      - [x] Поле для URL локального сервера (по умолчанию http://localhost:1234)
      - [x] Загрузка и выбор модели из списка
      - [x] Интеграция с API endpoint `/api/llm/generate-map`
    - [x] Обновление API endpoint для поддержки локальных моделей
      - [x] Функция `generateMapWithLocalModel()` для генерации через локальный API
      - [x] Функция `convertGeneratedHexesToGameMap()` для конвертации результата
      - [x] Увеличенный timeout (10 минут) для долгих запросов
      - [x] Обработка обрезанных JSON ответов (regex извлечение валидных hex объектов)
      - [x] Улучшенные промпты с примерами использования тайлов
      - [x] Правило размещения объектов: все на height 0, декорации поверх базовых тайлов
      - [x] Конфигурация `maxDuration = 600` для Next.js API route

## Контекст Сессии

### Недавние изменения

1. **✅ Рефакторинг `exits` → `connections`** (2025-12-28):
   - Переименовано поле `exits` → `connections` во всем коде для более точной терминологии
   - Мы определяем не "выходы", а **типы соединений** для стыковки с соседними тайлами
   - Обновлены файлы: `AssetAnalyzer.ts`, `MapGenerator.ts`, UI (`page.tsx`), API endpoints
   - Интерфейс `TileDescriptor` теперь использует `connections?: TileConnections`

2. **✅ Исправлен анализ соединений для базовых тайлов** (2025-12-28):
   - Добавлена категория `'base'` в список для анализа соединений (раньше была пропущена)
   - Теперь `hex_grass` корректно определяется с 6 соединениями типа `grass`

3. **✅ Новая логика анализа: рёбра верхней поверхности** (2025-12-28):
   - `TileConnectionAnalyzer` теперь анализирует **только верхнюю поверхность** тайла
   - Алгоритм:
     1. Находится maxY (верхняя поверхность)
     2. Фильтруются вершины с Y ≈ maxY (TOP_SURFACE_TOLERANCE = 0.1)
     3. Для каждой из 6 сторон проверяется — есть ли вершины верхней поверхности **на ребре**
     4. Ребро считается открытым если: distance ∈ [innerRadius*0.9, outerRadius*1.1] и угол ±30°
   - Тип соединения определяется по `tileType` и `biome`:
     * river→water, road→road, coast→coast
     * base: water biome→water, другие→grass
   - Визуализация: цветные сферы на рёбрах с обновлёнными цветами:
     * Grass: чистый зеленый (0x00ff00)
     * Water: чистый синий (0x0066ff)
     * Coast: оранжево-золотой (0xffaa00)
     * Road: коричневый (0x8b4513)
     * Unknown: красный (0xff0000)
   - **Если соединения нет — ничего не отображается** (чистая грань без меток)

4. **✅ Обновлён `AssetAnalyzer` для учёта biome** (2025-12-28):
   - Добавлен параметр `biome` в функции `analyzeTileConnections` и `getConnectionsFromFilename`
   - Для базовых тайлов (base) тип соединения теперь определяется по биому:
     * `water` biome → соединение типа `water`
     * `forest`, `mountain`, `plains` biome → соединение типа `grass`
   - Исправлена проблема с `hex_water` показывающим 6 grass соединений вместо water

5. **✅ Исправлено позиционирование тайлов по уровням высоты**:
   - Введена константа `LEVEL_HEIGHT` (высота базового тайла) вместо использования переменной `actualHeight`
   - Тайлы верхних уровней теперь правильно размещаются на верхней поверхности нижележащих уровней
   - Формула позиционирования: `Y = level * LEVEL_HEIGHT - minY`
   - LEVEL_HEIGHT устанавливается один раз при первой загрузке базового тайла и используется как константа

6. **✅ Упрощена логика выделения тайлов**:
   - Убран параметр `height` из типа `selectedHex`
   - При клике всегда выбирается самый верхний тайл (topmost) независимо от `currentHeightLevel`
   - Упрощена функция `handleCanvasClick` - всегда возвращает верхний тайл из результатов raycaster
   - Обновлены все связанные функции для работы с topmost hex

7. **✅ Создана структура Memory Bank**: Инициализированы все необходимые файлы документации согласно методологии livedocs

8. **✅ Реализована система сохранения/загрузки карт**:
   - Создан `MapSerializer` класс для сериализации/десериализации карт
   - Оптимизированный JSON формат с sparse array (только непустые позиции)
   - Поддержка многоуровневых гексов (стеков до 5 уровней)
   - Сохранение метаданных моделей (obj, mtl, name)
   - Версионирование формата для совместимости
   - Интеграция кнопок Save/Open в UI редактора
   - Документация формата в `docs/map-file-format.md`
   - **Улучшения UX**: Диалог для имени карты при сохранении, toast уведомления вместо alert
   - **Валидация**: Проверка формата файла перед загрузкой через `MapSerializer.validate()`
   - **Тестирование**: Созданы unit-тесты для MapSerializer (21 тест, все проходят)

9. **✅ Исправлена загрузка текстур в превью тайлов**:
   - Реализована очередь последовательного рендеринга превью для избежания конфликтов
   - Добавлена функция `waitForTexturesLoaded()` для проверки загрузки всех текстур в модели
   - Каждое превью использует уникальный идентификатор для корректной работы с общей сценой
   - Исправлены искажения пропорций при копировании изображения на 2D канвас
   - Добавлена правильная проверка загрузки HTMLImageElement через `complete` и `naturalWidth`
   - Реализовано ожидание загрузки текстур с таймаутом и дополнительными кадрами для применения в GPU

10. **✅ Проведен анализ системы координат для LLM-генерации**:
   - Создан документ `docs/hex-coordinates-analysis.md` с детальным сравнением
   - Выявлены проблемы: неправильная формула расстояния (используется Manhattan для квадратной сетки)
   - **Принято решение**: Полный переход на осевые координаты `(q, r)` вместо гибридного подхода
   - Обновлен план внедрения на 7 фаз полного рефакторинга
   - **Ключевые решения**:
     - Вся внутренняя логика переходит на осевые координаты `(q, r)`
     - Все классы (`Hex`, `Map`) используют `q, r` вместо `x, y`
     - Сериализация использует осевые координаты по умолчанию (версия формата 2.0)
     - Формула расстояния: `distance(a, b) = (|a.q - b.q| + |a.q + a.r - b.q - b.r| + |a.r - b.r|) / 2`
     - Упрощённая логика соседей: единообразное вычисление без условных операторов

11. **✅ Реализовано копирование и вставка тайлов**:
   - Копирование верхнего тайла в ячейке (Ctrl+C)
   - Вставка тайла в ячейку под курсором мыши (Ctrl+V)
   - Сохранение относительной высоты при вставке
   - Поддержка множественного копирования/вставки

11. **✅ Реализовано множественное выделение**:
   - Выделение нескольких тайлов (Ctrl+ЛКМ)
   - Визуализация рамки у всех выделенных тайлов
   - Массовое копирование/вставка выделенных тайлов

12. **✅ Реализована система undo/redo**:
   - История изменений до 50 состояний
   - Отмена операций (Ctrl+Z)
   - Повтор операций (Ctrl+Y, Ctrl+Shift+Z)
   - Сохранение состояния до и после операций редактирования
   - Флаг isUndoRedoInProgressRef для предотвращения сохранения истории во время undo/redo

13. **✅ Завершено тестирование LLM интеграции**:
   - Создан документ `docs/hex-coordinates-analysis.md` с детальным сравнением
   - Выявлены проблемы: неправильная формула расстояния (используется Manhattan для квадратной сетки)
   - **Принято решение**: Полный переход на осевые координаты `(q, r)` вместо гибридного подхода
   - Обновлен план внедрения на 7 фаз полного рефакторинга
   - **Ключевые решения**:
     - Вся внутренняя логика переходит на осевые координаты `(q, r)`
     - Все классы (`Hex`, `Map`) используют `q, r` вместо `x, y`
     - Сериализация использует осевые координаты по умолчанию (версия формата 2.0)
     - Формула расстояния: `distance(a, b) = (|a.q - b.q| + |a.q + a.r - b.q - b.r| + |a.r - b.r|) / 2`
     - Упрощённая логика соседей: единообразное вычисление без условных операторов

12. **✅ Реализовано копирование и вставка тайлов**:
   - Копирование верхнего тайла в ячейке (Ctrl+C)
   - Вставка тайла в ячейку под курсором мыши (Ctrl+V)
   - Сохранение относительной высоты при вставке
   - Поддержка множественного копирования/вставки

13. **✅ Реализовано множественное выделение**:
   - Выделение нескольких тайлов (Ctrl+ЛКМ)
   - Визуализация рамки у всех выделенных тайлов
   - Массовое копирование/вставка выделенных тайлов

14. **✅ Реализована система undo/redo**:
   - История изменений до 50 состояний
   - Отмена операций (Ctrl+Z)
   - Повтор операций (Ctrl+Y, Ctrl+Shift+Z)
   - Сохранение состояния до и после операций редактирования
   - Флаг isUndoRedoInProgressRef для предотвращения сохранения истории во время undo/redo

15. **✅ Завершено тестирование LLM интеграции**:
    - Установлен и настроен Gemini 2.5 Flash API (1M input, 64K output токенов)
    - Все тесты пройдены успешно:
      - ✅ Тест 1: Простое подключение
      - ✅ Тест 2: JSON Schema (структурированный вывод)
      - ✅ Тест 3: Генерация примера hex карты (3x3 карта сгенерирована корректно)
    - Выявлены и исправлены ограничения Gemini API:
      - Не поддерживает `additionalProperties` в JSON Schema
      - `enum` может содержать только строки, не числа (для чисел использовать minimum/maximum)
    - Создана тестовая инфраструктура:
      - `/api/llm/test` - тестовые endpoints
      - `/api/llm/list-models` - список доступных моделей
      - `/test-llm` - UI для тестирования
    - Документация: `docs/llm-integration-plan.md`, `docs/llm-api-testing.md`, `docs/llm-testing-results.md`
    - **Результат теста 3**: Успешно сгенерирована карта 3x3 с правильными координатами (q, r), tile_id, rotation и height

16. **✅ Завершена Фаза 1: Подготовка инфраструктуры**:
    - Создан `AssetAnalyzer` (`lib/llm/AssetAnalyzer.ts`) для парсинга OBJ/MTL файлов
    - Реализована генерация tile_id по паттерну: `{category}_{subcategory}_{filename}`
    - Создан скрипт `scripts/generate-tile-registry.ts` для генерации реестра тайлов
    - **Реестр тайлов сгенерирован**: 263 тайла в `lib/llm/tile-registry.json`
      - По категориям: buildings (135), decoration (68), tiles (60)
      - По биомам: plains (178), water (55), forest (18), mountain (12)
    - Создан `LLMClient` (`lib/llm/LLMClient.ts`) для работы с Gemini API
    - Добавлен npm script: `bun run generate-registry`

17. **✅ Завершена Фаза 2: Базовая генерация карт**:
    - Создан `MapGenerator` (`lib/llm/MapGenerator.ts`) для генерации карт через LLM
    - Реализована загрузка tile registry из JSON файла
    - Создан JSON Schema для валидации выходных данных LLM
    - Реализовано формирование промпта с правилами генерации карт
    - Интегрирована генерация через LLMClient с поддержкой retry
    - Реализована конвертация GeneratedHex → Hex с использованием реестра тайлов
    - Создан API endpoint `/api/llm/generate-map` для тестирования
    - Добавлена кнопка "Тест 4: Генерация карты 5x5" на тестовой странице

18. **✅ Реализовано быстрое копирование тайла при перетаскивании с CTRL** (2025-12-28):
    - Добавлен ref `isCopyModeRef` для отслеживания состояния CTRL при начале перетаскивания
    - Создана функция `copyHexAtPosition` для копирования тайла без удаления оригинала
    - Обновлена логика `handleCanvasClick` для выбора между копированием (CTRL) и перемещением (обычный drag)
    - Сохранение состояния CTRL в `onMouseDown` для определения режима копирования
    - Поддержка undo/redo для операций копирования через `saveHistoryState()`
    - Автоматический поиск свободного уровня при копировании, если целевой уровень занят
    - Toast уведомление "Тайл скопирован" при успешном копировании
    - **Использование**: Зажать CTRL, начать перетаскивание тайла - создастся копия вместо перемещения

19. **✅ Операции с тайлами без предварительного выделения** (2025-12-28):
    - Обновлена функция `copyHex`: если нет выделенных тайлов, копирует тайл под курсором мыши
    - Обновлена логика `onMouseDown`: перетаскивание начинается с тайла под курсором, даже если он не выделен
    - Все операции (копирование, перетаскивание, быстрое копирование) теперь работают без необходимости предварительного выделения
    - Используется `lastMouseHexRef` для отслеживания позиции тайла под курсором
    - **Использование**:
      * Наведите курсор на тайл и нажмите Ctrl+C - скопирует тайл под курсором
      * Наведите курсор на тайл и перетащите - переместит тайл под курсором
      * Наведите курсор на тайл, зажмите CTRL и перетащите - скопирует тайл под курсором

20. **✅ Поддержка локальных LLM моделей** (2025-12-28):
    - Доработана страница тестирования LLM (`/test-llm`) для работы с локальными серверами
    - Добавлен переключатель между Gemini API и локальным сервером
    - Реализована загрузка списка моделей через GET /v1/models
    - Добавлен выбор модели из списка
    - Созданы тесты аналогичные Gemini API для локальных моделей
    - Исправлен формат JSON Schema (убрано json_object, используется system message)
    - Доработана страница генерации карт с поддержкой локальных моделей
    - Обновлен API endpoint `/api/llm/generate-map` для работы с локальными моделями
    - Увеличены таймауты (10 минут) для долгих запросов к локальным моделям
    - Улучшена обработка обрезанных JSON ответов
    - Оптимизированы промпты для лучшего использования разнообразия тайлов
    - Добавлено правило: все объекты размещаются на height 0, декорации поверх базовых тайлов

21. **✅ Реализована система автоматического анализа соединений тайлов**:
    - Создан `TileConnectionAnalyzer` (`lib/llm/TileConnectionAnalyzer.ts`) для анализа геометрии OBJ файлов
    - Реализован анализ рёбер верхней поверхности для определения соединений
    - Улучшены эвристики по именам файлов с поддержкой паттернов:
      * `crossing` - пересечение реки и дороги (2 соединения для реки, 2 для дороги)
      * `straight` - 2 противоположных соединения (E-W, NE-SW, или NW-SE)
      * `corner` - 2 соседних соединения (угол)
      * `left/right` - направленные соединения
      * `inside/outside` - для побережья (внутренняя/внешняя сторона)
    - Обновлен `AssetAnalyzer` для включения информации о соединениях в tile registry
    - Обновлен `MapGenerator` для использования информации о соединениях в промптах LLM
    - Реализована валидация связности рек/дорог после генерации (`validateConnectivity`)
    - **Только автоматические методы**: Эвристика имени файла (приоритет) > Анализ геометрии
    - **Ручной ввод исключен**: Система полностью автоматическая
    - **Интерфейс проверки соединений**: Создана страница `/generate-registry` с визуализацией тайлов
      * 3D превью тайлов с подсветкой соединений (сферы с цветовой индикацией типа)
      * Интерфейс утверждения соединений (кнопка "Утвердить")
      * Сохранение реестра после проверки
    - **API endpoints**:
      * `/api/llm/generate-registry` - генерация реестра с соединениями
      * `/api/llm/save-registry` - сохранение реестра в файл

### Открытые вопросы

1. **Выбор LLM API**: Рекомендуется Gemini 2.0 Flash (бесплатный tier, JSON Schema). Нужно ли добавить поддержку локальных моделей (Ollama) для офлайн режима?
2. **Размер генерации**: Для больших карт (50x50+) нужно использовать иерархическую генерацию или достаточно простой подход?

### Принятые решения (LLM интеграция)

1. **LLM API**: Google Gemini 2.0 Flash как основной провайдер (бесплатный tier, нативная поддержка JSON Schema)
2. **Архитектура генерации**: Иерархический синтез контента (3 фазы: биомы → высоты → тайлы)
3. **Формат данных**: Реестр тайлов в JSON формате (`tile-registry.json`)
4. **Промпт-инжиниринг**: Структурированные промпты с JSON Schema для гарантии формата
5. **Документация**: Полный план интеграции в `docs/llm-integration-plan.md`

### Принятые решения

1. **Memory Bank в корне проекта**: Используем `.memory_bank/` в корне для единой документации проекта
2. **Независимый проект**: **Medieval Hexagon Map Editor** - полностью независимый проект на Next.js 16 + React 19
3. **TypeScript**: Все классы (`Map`, `Hex`, `MapSerializer`) реализованы на TypeScript в `lib/game/`
4. **Bun**: Используем Bun как пакетный менеджер (быстрее npm)
5. **Biome**: Линтер и форматер (быстрее ESLint+Prettier)
6. **Turbopack**: Bundler по умолчанию (быстрее webpack для dev)
7. **Shadcn/ui тема**: Maia style, Cyan theme, Large radius, Public Sans font, темная тема по умолчанию
8. **Система уровней тайлов**: LEVEL_HEIGHT - константа, равная высоте базового тайла. Используется для позиционирования всех уровней
9. **Выделение тайлов**: Всегда выбирается верхний тайл в стопке. Поддержка множественного выделения с визуализацией рамки у всех выделенных тайлов
10. **Формат файла карты**: JSON формат с оптимизацией (sparse array, минимизация повторяющихся данных). Размер файла: ~200 байт на гекс. Поддержка версионирования для совместимости (версия 2.0 с осевыми координатами)
11. **Тестирование**: Vitest настроен для unit-тестов. MapSerializer и HexCoordinateConverter покрыты тестами
12. **UX улучшения**: Toast уведомления для обратной связи, диалог для имени карты, валидация файлов перед загрузкой
13. **Осевые координаты**: Использование (q, r) координат для LLM-совместимости
14. **Undo/Redo**: История изменений до 50 состояний с поддержкой Ctrl+Z/Ctrl+Y

## Важные Заметки

- **Правила livedocs**: Отныне перед началом каждой задачи нужно читать `activeContext.md` для понимания контекста
- **Обновление документации**: После каждого значимого изменения обновлять соответствующие файлы Memory Bank
- **Git хэш**: В `progress.md` должен быть актуальный хэш последнего коммита для отслеживания изменений
- **Независимый проект**: Medieval Hexagon Map Editor - полностью отдельный проект, не связанный с другими игровыми проектами
